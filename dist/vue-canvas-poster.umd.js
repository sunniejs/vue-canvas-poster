!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],s):s((t="undefined"!=typeof globalThis?globalThis:t||self)["vue-canvas-poster"]={},t.Vue)}(this,(function(t,s){"use strict";var e,i,r,o,h,c,a=[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28],n=[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177],l=[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],d=[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],f=[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175],g=[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],x=[],u=[],b=[],p=[],w=[],P=2;function y(t,s){var e;t>s&&(e=t,t=s,s=e),e=s,e*=s,e+=s,e>>=1,p[e+=t]=1}function m(t,s){var e;for(b[t+i*s]=1,e=-2;e<2;e++)b[t+e+i*(s-2)]=1,b[t-2+i*(s+e+1)]=1,b[t+2+i*(s+e)]=1,b[t+e+1+i*(s+2)]=1;for(e=0;e<2;e++)y(t-1,s+e),y(t+1,s-e),y(t-e,s-1),y(t+e,s+1)}function v(t){for(;t>=255;)t=((t-=255)>>8)+(255&t);return t}var S=[];function I(t,s,e,i){var r,o,h;for(r=0;r<i;r++)x[e+r]=0;for(r=0;r<s;r++){if(255!=(h=f[x[t+r]^x[e]]))for(o=1;o<i;o++)x[e+o-1]=x[e+o]^g[v(h+S[i-o])];else for(o=e;o<e+i;o++)x[o]=x[o+1];x[e+i-1]=255==h?0:g[v(h+S[0])]}}function k(t,s){var e;return t>s&&(e=t,t=s,s=e),e=s,e+=s*s,e>>=1,p[e+=t]}function M(t){var s,e,r,o;switch(t){case 0:for(e=0;e<i;e++)for(s=0;s<i;s++)s+e&1||k(s,e)||(b[s+e*i]^=1);break;case 1:for(e=0;e<i;e++)for(s=0;s<i;s++)1&e||k(s,e)||(b[s+e*i]^=1);break;case 2:for(e=0;e<i;e++)for(r=0,s=0;s<i;s++,r++)3==r&&(r=0),r||k(s,e)||(b[s+e*i]^=1);break;case 3:for(o=0,e=0;e<i;e++,o++)for(3==o&&(o=0),r=o,s=0;s<i;s++,r++)3==r&&(r=0),r||k(s,e)||(b[s+e*i]^=1);break;case 4:for(e=0;e<i;e++)for(r=0,o=e>>1&1,s=0;s<i;s++,r++)3==r&&(r=0,o=!o),o||k(s,e)||(b[s+e*i]^=1);break;case 5:for(o=0,e=0;e<i;e++,o++)for(3==o&&(o=0),r=0,s=0;s<i;s++,r++)3==r&&(r=0),(s&e&1)+!(!r|!o)||k(s,e)||(b[s+e*i]^=1);break;case 6:for(o=0,e=0;e<i;e++,o++)for(3==o&&(o=0),r=0,s=0;s<i;s++,r++)3==r&&(r=0),(s&e&1)+(r&&r==o)&1||k(s,e)||(b[s+e*i]^=1);break;case 7:for(o=0,e=0;e<i;e++,o++)for(3==o&&(o=0),r=0,s=0;s<i;s++,r++)3==r&&(r=0),(r&&r==o)+(s+e&1)&1||k(s,e)||(b[s+e*i]^=1)}}function _(t){var s,e=0;for(s=0;s<=t;s++)w[s]>=5&&(e+=3+w[s]-5);for(s=3;s<t-1;s+=2)w[s-2]==w[s+2]&&w[s+2]==w[s-1]&&w[s-1]==w[s+1]&&3*w[s-1]==w[s]&&(0==w[s-3]||s+3>t||3*w[s-3]>=4*w[s]||3*w[s+3]>=4*w[s])&&(e+=40);return e}function W(){var t,s,e,r,o,h=0,c=0;for(s=0;s<i-1;s++)for(t=0;t<i-1;t++)(b[t+i*s]&&b[t+1+i*s]&&b[t+i*(s+1)]&&b[t+1+i*(s+1)]||!(b[t+i*s]||b[t+1+i*s]||b[t+i*(s+1)]||b[t+1+i*(s+1)]))&&(h+=3);for(s=0;s<i;s++){for(w[0]=0,e=r=t=0;t<i;t++)(o=b[t+i*s])==r?w[e]++:w[++e]=1,c+=(r=o)?1:-1;h+=_(e)}c<0&&(c=-c);var a=c,n=0;for(a+=a<<2,a<<=1;a>i*i;)a-=i*i,n++;for(h+=10*n,t=0;t<i;t++){for(w[0]=0,e=r=s=0;s<i;s++)(o=b[t+i*s])==r?w[e]++:w[++e]=1,r=o;h+=_(e)}return h}var T=null;const R={get ecclevel(){return P},set ecclevel(t){P=t},get size(){return _size},set size(t){_size=t},get canvas(){return T},set canvas(t){T=t},getFrame:function(t){return function(t){var s,w,_,T,R,C,A,H;T=t.length,e=0;do{if(e++,_=4*(P-1)+16*(e-1),r=d[_++],o=d[_++],h=d[_++],c=d[_],T<=(_=h*(r+o)+o-3+(e<=9)))break}while(e<40);for(i=17+4*e,R=h+(h+c)*(r+o)+o,T=0;T<R;T++)u[T]=0;for(x=t.slice(0),T=0;T<i*i;T++)b[T]=0;for(T=0;T<(i*(i+1)+1)/2;T++)p[T]=0;for(T=0;T<3;T++){for(_=0,w=0,1==T&&(_=i-7),2==T&&(w=i-7),b[w+3+i*(_+3)]=1,s=0;s<6;s++)b[w+s+i*_]=1,b[w+i*(_+s+1)]=1,b[w+6+i*(_+s)]=1,b[w+s+1+i*(_+6)]=1;for(s=1;s<5;s++)y(w+s,_+1),y(w+1,_+s+1),y(w+5,_+s),y(w+s+1,_+5);for(s=2;s<4;s++)b[w+s+i*(_+2)]=1,b[w+2+i*(_+s+1)]=1,b[w+4+i*(_+s)]=1,b[w+s+1+i*(_+4)]=1}if(e>1)for(T=a[e],w=i-7;;){for(s=i-7;s>T-3&&(m(s,w),!(s<T));)s-=T;if(w<=T+9)break;m(6,w-=T),m(w,6)}for(b[8+i*(i-8)]=1,w=0;w<7;w++)y(7,w),y(i-8,w),y(7,w+i-7);for(s=0;s<8;s++)y(s,7),y(s+i-8,7),y(s,i-8);for(s=0;s<9;s++)y(s,8);for(s=0;s<8;s++)y(s+i-8,8),y(8,s);for(w=0;w<7;w++)y(8,w+i-7);for(s=0;s<i-14;s++)1&s?(y(8+s,6),y(6,8+s)):(b[8+s+6*i]=1,b[6+i*(8+s)]=1);if(e>6)for(T=n[e-7],_=17,s=0;s<6;s++)for(w=0;w<3;w++,_--)1&(_>11?e>>_-12:T>>_)?(b[5-s+i*(2-w+i-11)]=1,b[2-w+i-11+i*(5-s)]=1):(y(5-s,2-w+i-11),y(2-w+i-11,5-s));for(w=0;w<i;w++)for(s=0;s<=w;s++)b[s+i*w]&&y(s,w);for(R=x.length,C=0;C<R;C++)u[C]=x.charCodeAt(C);if(x=u.slice(0),R>=(s=h*(r+o)+o)-2&&(R=s-2,e>9&&R--),C=R,e>9){for(x[C+2]=0,x[C+3]=0;C--;)T=x[C],x[C+3]|=255&T<<4,x[C+2]=T>>4;x[2]|=255&R<<4,x[1]=R>>4,x[0]=64|R>>12}else{for(x[C+1]=0,x[C+2]=0;C--;)T=x[C],x[C+2]|=255&T<<4,x[C+1]=T>>4;x[1]|=255&R<<4,x[0]=64|R>>4}for(C=R+3-(e<10);C<s;)x[C++]=236,x[C++]=17;for(S[0]=1,C=0;C<c;C++){for(S[C+1]=1,A=C;A>0;A--)S[A]=S[A]?S[A-1]^g[v(f[S[A]]+C)]:S[A-1];S[0]=g[v(f[S[0]]+C)]}for(C=0;C<=c;C++)S[C]=f[S[C]];for(_=s,w=0,C=0;C<r;C++)I(w,h,_,c),w+=h,_+=c;for(C=0;C<o;C++)I(w,h+1,_,c),w+=h+1,_+=c;for(w=0,C=0;C<h;C++){for(A=0;A<r;A++)u[w++]=x[C+A*h];for(A=0;A<o;A++)u[w++]=x[r*h+C+A*(h+1)]}for(A=0;A<o;A++)u[w++]=x[r*h+C+A*(h+1)];for(C=0;C<c;C++)for(A=0;A<r+o;A++)u[w++]=x[s+C+A*c];for(x=u,s=w=i-1,_=R=1,H=(h+c)*(r+o)+o,C=0;C<H;C++)for(T=x[C],A=0;A<8;A++,T<<=1){128&T&&(b[s+i*w]=1);do{R?s--:(s++,_?0!=w?w--:(_=!_,6==(s-=2)&&(s--,w=9)):w!=i-1?w++:(_=!_,6==(s-=2)&&(s--,w-=8))),R=!R}while(k(s,w))}for(x=b.slice(0),T=0,w=3e4,_=0;_<8&&(M(_),(s=W())<w&&(w=s,T=_),7!=T);_++)b=x.slice(0);for(T!=_&&M(T),w=l[T+(P-1<<3)],_=0;_<8;_++,w>>=1)1&w&&(b[i-1-_+8*i]=1,_<6?b[8+i*_]=1:b[8+i*(_+1)]=1);for(_=0;_<7;_++,w>>=1)1&w&&(b[8+i*(i-7+_)]=1,_?b[6-_+8*i]=1:b[7+8*i]=1);return b}(t)},utf16to8:function(t){var s,e,i,r;for(s="",i=t.length,e=0;e<i;e++)(r=t.charCodeAt(e))>=1&&r<=127?s+=t.charAt(e):r>2047?(s+=String.fromCharCode(224|r>>12&15),s+=String.fromCharCode(128|r>>6&63),s+=String.fromCharCode(128|r>>0&63)):(s+=String.fromCharCode(192|r>>6&31),s+=String.fromCharCode(128|r>>0&63));return s},draw:function(t,s,e,r,o,h,c,a,n,l){if(P=l||P,s){var d=Math.min(o,h);t=this.utf16to8(t);var f=this.getFrame(t),g=d/i;c&&(s.fillStyle=c,s.fillRect(e,r,o,o)),s.fillStyle=a||"black";for(var x=0;x<i;x++)for(var u=0;u<i;u++)f[u*i+x]&&s.fillRect(e+g*x,r+g*u,g,g)}else console.warn("No canvas provided to draw QR code in!")}},C=function(t){return!(!t||!t.startsWith("linear")&&!t.startsWith("radial"))},A=function(t,s,e,i){t.startsWith("linear")?function(t,s,e,i){const r=function(t,s,e){const i=t.match(/([-]?\d{1,3})deg/);let r;switch(i&&i[1]?parseFloat(i[1]):0){case 0:r=[0,-e/2,0,e/2];break;case 90:r=[s/2,0,-s/2,0];break;case-90:r=[-s/2,0,s/2,0];break;case 180:r=[0,e/2,0,-e/2];break;case-180:r=[0,-e/2,0,e/2];break;default:let t=0,o=0,h=0,c=0;i[1]>0&&i[1]<90?(t=s/2-(s/2*Math.tan((90-i[1])*Math.PI*2/360)-e/2)*Math.sin(2*(90-i[1])*Math.PI*2/360)/2,c=Math.tan((90-i[1])*Math.PI*2/360)*t,h=-t,o=-c):i[1]>-180&&i[1]<-90?(t=-s/2+(s/2*Math.tan((90-i[1])*Math.PI*2/360)-e/2)*Math.sin(2*(90-i[1])*Math.PI*2/360)/2,c=Math.tan((90-i[1])*Math.PI*2/360)*t,h=-t,o=-c):i[1]>90&&i[1]<180?(t=s/2+(-s/2*Math.tan((90-i[1])*Math.PI*2/360)-e/2)*Math.sin(2*(90-i[1])*Math.PI*2/360)/2,c=Math.tan((90-i[1])*Math.PI*2/360)*t,h=-t,o=-c):(t=-s/2-(-s/2*Math.tan((90-i[1])*Math.PI*2/360)-e/2)*Math.sin(2*(90-i[1])*Math.PI*2/360)/2,c=Math.tan((90-i[1])*Math.PI*2/360)*t,h=-t,o=-c),r=[t,o,h,c]}return r}(e,t,s),o=i.createLinearGradient(r[0],r[1],r[2],r[3]),h=e.match(/linear-gradient\((.+)\)/)[1],c=H(h.substring(h.indexOf(",")+1));for(let a=0;a<c.colors.length;a++)o.addColorStop(c.percents[a],c.colors[a]);i.fillStyle=o}(s,e,t,i):t.startsWith("radial")&&function(t,s,e,i){const r=H(e.match(/radial-gradient\((.+)\)/)[1]),o=i.createRadialGradient(0,0,0,0,0,t<s?s/2:t/2);for(let h=0;h<r.colors.length;h++)o.addColorStop(r.percents[h],r.colors[h]);i.fillStyle=o}(s,e,t,i)};function H(t){const s=t.substring(0,t.length-1).split("%,"),e=[],i=[];for(let r of s)e.push(r.substring(0,r.lastIndexOf(" ")).trim()),i.push(r.substring(r.lastIndexOf(" "),r.length)/100);return{colors:e,percents:i}}class ${constructor(t,s){this.ctx=t,this.data=s,this.globalWidth={},this.globalHeight={}}paint(t){if(this.style={width:this.data.width.toPx(),height:this.data.height.toPx()},this._background(),this.data.views&&this.data.views.length>0)for(const s of this.data.views)this._drawAbsolute(s);t&&t()}_background(){this.ctx.save();const{width:t,height:s}=this.style,e=this.data.background;this.ctx.translate(t/2,s/2),this._doClip(this.data.borderRadius,t,s),e?e.src?this.ctx.drawImage(e,-t/2,-s/2,t,s):e.startsWith("#")||e.startsWith("rgba")||"transparent"===e.toLowerCase()?(this.ctx.fillStyle=e,this.ctx.fillRect(-t/2,-s/2,t,s)):C(e)&&(A(e,t,s,this.ctx),this.ctx.fillRect(-t/2,-s/2,t,s)):(this.ctx.fillStyle="transparent",this.ctx.fillRect(-t/2,-s/2,t,s)),this.ctx.restore()}_drawAbsolute(t){if(t&&t.type)switch(t.css&&t.css.length&&(t.css=Object.assign(...t.css)),t.type){case"image":this._drawAbsImage(t);break;case"text":this._fillAbsText(t);break;case"rect":this._drawAbsRect(t);break;case"qrcode":this._drawQRCode(t)}}_border({borderRadius:t=0,width:s,height:e,borderWidth:i=0,borderStyle:r="solid"}){let o=0,h=0,c=0,a=0;const n=Math.min(s,e);if(t){const i=t.split(/\s+/);4===i.length?(o=Math.min(i[0].toPx(!1,n),s/2,e/2),h=Math.min(i[1].toPx(!1,n),s/2,e/2),c=Math.min(i[2].toPx(!1,n),s/2,e/2),a=Math.min(i[3].toPx(!1,n),s/2,e/2)):o=h=c=a=Math.min(t&&t.toPx(!1,n),s/2,e/2)}const l=i&&i.toPx(!1,n);this.ctx.lineWidth=l,"dashed"===r?this.ctx.setLineDash([4*l/3,4*l/3]):"dotted"===r&&this.ctx.setLineDash([l,l]);const d="solid"!==r;this.ctx.beginPath(),d&&0===o&&this.ctx.moveTo(-s/2-l,-e/2-l/2),0!==o&&this.ctx.arc(-s/2+o,-e/2+o,o+l/2,1*Math.PI,1.5*Math.PI),this.ctx.lineTo(0===h?d?s/2:s/2+l/2:s/2-h,-e/2-l/2),d&&0===h&&this.ctx.moveTo(s/2+l/2,-e/2-l),0!==h&&this.ctx.arc(s/2-h,-e/2+h,h+l/2,1.5*Math.PI,2*Math.PI),this.ctx.lineTo(s/2+l/2,0===c?d?e/2:e/2+l/2:e/2-c),d&&0===c&&this.ctx.moveTo(s/2+l,e/2+l/2),0!==c&&this.ctx.arc(s/2-c,e/2-c,c+l/2,0,.5*Math.PI),this.ctx.lineTo(0===a?d?-s/2:-s/2-l/2:-s/2+a,e/2+l/2),d&&0===a&&this.ctx.moveTo(-s/2-l/2,e/2+l),0!==a&&this.ctx.arc(-s/2+a,e/2-a,a+l/2,.5*Math.PI,1*Math.PI),this.ctx.lineTo(-s/2-l/2,0===o?d?-e/2:-e/2-l/2:-e/2+o),d&&0===o&&this.ctx.moveTo(-s/2-l,-e/2-l/2),d||this.ctx.closePath()}_doClip(t,s,e,i){t&&s&&e&&(this.ctx.globalAlpha=0,this.ctx.fillStyle="white",this._border({borderRadius:t,width:s,height:e,borderStyle:i}),this.ctx.fill(),this.ctx.clip(),this.ctx.globalAlpha=1)}_doBorder(t,s,e){if(!t.css)return;const{borderRadius:i,borderWidth:r,borderColor:o,borderStyle:h}=t.css;r&&(this.ctx.save(),this._preProcess(t,!0),this.ctx.strokeStyle=o||"black",this._border({borderRadius:i,width:s,height:e,borderWidth:r,borderStyle:h}),this.ctx.stroke(),this.ctx.restore())}_preProcess(t,s){let e,i,r=0;const o=this._doPaddings(t);switch(t.type){case"text":{const s=t.text.split("\n");for(let t=0;t<s.length;++t)""===s[t]&&(s[t]=" ");const h=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"].includes(t.css.fontWeight)?t.css.fontWeight:"normal",c="italic"===t.css.textStyle?"italic":"normal";let a=t.css.textIndent?t.css.textIndent.toPx():0;t.css.fontSize||(t.css.fontSize="20rpx"),this.ctx.font=`${c} ${h} ${t.css.fontSize.toPx()}px "${t.css.fontFamily||"sans-serif"}"`;let n=0;const l=[];for(let e=0;e<s.length;++e){const i=this.ctx.measureText(s[e]).width,h=t.css.fontSize.toPx()+o[1]+o[3];let c=t.css.width?t.css.width.toPx(!1,this.style.width)-o[1]-o[3]:i;c<h&&(c=h),a=a>c?c:a;const d=Math.ceil((i+a)/c);r=c>r?c:r,n+=d,l[e]=d}n=t.css.maxLines<n?t.css.maxLines:n;const d=t.css.lineHeight?t.css.lineHeight.toPx():t.css.fontSize.toPx();e=d*n,i={textIndent:a,lines:n,lineHeight:d,textArray:s,linesArray:l};break}case"image":t.css&&(t.css.width||(t.css.width="auto"),t.css.height||(t.css.height="auto")),!t.css||"auto"===t.css.width&&"auto"===t.css.height?(r=Math.round(t.sWidth),e=Math.round(t.sHeight)):"auto"===t.css.width?(e=t.css.height.toPx(!1,this.style.height),r=t.sWidth/t.sHeight*e):"auto"===t.css.height?(r=t.css.width.toPx(!1,this.style.width),e=t.sHeight/t.sWidth*r):(r=t.css.width.toPx(!1,this.style.width),e=t.css.height.toPx(!1,this.style.height));break;default:if(!t.css.width||!t.css.height)return void console.error("You should set width and height");r=t.css.width.toPx(!1,this.style.width),e=t.css.height.toPx(!1,this.style.height)}let h,c;if(t.css&&t.css.right)if("string"==typeof t.css.right)h=this.style.width-t.css.right.toPx(!0,this.style.width);else{const s=t.css.right;h=this.style.width-s[0].toPx(!0,this.style.width)-this.globalWidth[s[1]]*(s[2]||1)}else if(t.css&&t.css.left)if("string"==typeof t.css.left)h=t.css.left.toPx(!0,this.style.width);else{const s=t.css.left;h=s[0].toPx(!0,this.style.width)+this.globalWidth[s[1]]*(s[2]||1)}else h=0;if(t.css&&t.css.bottom)c=this.style.height-e-t.css.bottom.toPx(!0,this.style.height);else if(t.css&&t.css.top)if("string"==typeof t.css.top)c=t.css.top.toPx(!0,this.style.height);else{const s=t.css.top;c=s[0].toPx(!0,this.style.height)+this.globalHeight[s[1]]*(s[2]||1)}else c=0;const a=t.css&&t.css.rotate?this._getAngle(t.css.rotate):0,n=t.css&&t.css.align?t.css.align:t.css&&t.css.right?"right":"left",l=t.css&&t.css.verticalAlign?t.css.verticalAlign:"top";let d=0;switch(n){case"center":d=h;break;case"right":d=h-r/2;break;default:d=h+r/2}let f=0;switch(l){case"center":f=c;break;case"bottom":f=c-e/2;break;default:f=c+e/2}this.ctx.translate(d,f);let g=h;"center"===n?g=h-r/2:"right"===n&&(g=h-r);var x=c;return"center"===l?x=c-e/2:"bottom"===l&&(x=c-e),t.rect?(t.rect.left=g,t.rect.top=x,t.rect.right=g+r,t.rect.bottom=x+e,t.rect.x=t.css&&t.css.right?h-r:h,t.rect.y=c):t.rect={left:g,top:x,right:g+r,bottom:x+e,x:t.css&&t.css.right?h-r:h,y:c},t.rect.left=t.rect.left-o[3],t.rect.top=t.rect.top-o[0],t.rect.right=t.rect.right+o[1],t.rect.bottom=t.rect.bottom+o[2],"text"===t.type&&(t.rect.minWidth=t.css.fontSize.toPx()+o[1]+o[3]),this.ctx.rotate(a),!s&&t.css&&t.css.borderRadius&&"rect"!==t.type&&this._doClip(t.css.borderRadius,r,e,t.css.borderStyle),this._doShadow(t),t.id&&(this.globalWidth[t.id]=r,this.globalHeight[t.id]=e),{width:r,height:e,x:h,y:c,extra:i}}_doPaddings(t){const{padding:s}=t.css?t.css:{};let e=[0,0,0,0];if(s){const t=s.split(/\s+/);if(1===t.length){const s=t[0].toPx();e=[s,s,s,s]}if(2===t.length){const s=t[0].toPx(),i=t[1].toPx();e=[s,i,s,i]}if(3===t.length){const s=t[0].toPx(),i=t[1].toPx();e=[s,i,t[2].toPx(),i]}if(4===t.length){e=[t[0].toPx(),t[1].toPx(),t[2].toPx(),t[3].toPx()]}}return e}_doBackground(t){this.ctx.save();const{width:s,height:e}=this._preProcess(t,!0),{background:i}=t.css;let r=this._doPaddings(t);const o=s+r[1]+r[3],h=e+r[0]+r[2];this._doClip(t.css.borderRadius,o,h,t.css.borderStyle),C(i)?A(i,o,h,this.ctx):this.ctx.fillStyle=i,this.ctx.fillRect(-o/2,-h/2,o,h),this.ctx.restore()}_drawQRCode(t){this.ctx.save();const{width:s,height:e}=this._preProcess(t);R.draw(t.content,this.ctx,-s/2,-e/2,s,e,t.css.background,t.css.color),this.ctx.restore(),this._doBorder(t,s,e)}_drawAbsImage(t){if(!t.url)return;this.ctx.save();const{width:s,height:e}=this._preProcess(t);if("string"==typeof t.url)return this.ctx.fillStyle="#ddd",this.ctx.fillRect(-s/2,-e/2,s,e),void this.ctx.restore();let i=t.sWidth,r=t.sHeight,o=0,h=0;const c=s/e;c>=t.sWidth/t.sHeight?(r=i/c,h=Math.round((t.sHeight-r)/2)):(i=r*c,o=Math.round((t.sWidth-i)/2)),t.css&&"scaleToFill"===t.css.mode?this.ctx.drawImage(t.url,-s/2,-e/2,s,e):(this.ctx.drawImage(t.url,o,h,i,r,-s/2,-e/2,s,e),t.rect.startX=o/t.sWidth,t.rect.startY=h/t.sHeight,t.rect.endX=(o+i)/t.sWidth,t.rect.endY=(h+r)/t.sHeight),this.ctx.restore(),this._doBorder(t,s,e)}_fillAbsText(t){if(!t.text)return;t.css.background&&this._doBackground(t),this.ctx.save();const{width:s,height:e,extra:i}=this._preProcess(t,t.css.background&&t.css.borderRadius);this.ctx.fillStyle=t.css.color||"black";const{lines:r,lineHeight:o,textArray:h,linesArray:c,textIndent:a}=i;if(t.id){let e=0;for(let t=0;t<h.length;++t){const s=this.ctx.measureText(h[t]).width;e=s>e?s:e}this.globalWidth[t.id]=s?e<s?e:s:e}let n=0,l=0;for(let d=0;d<h.length;++d){const i=Math.ceil(h[d].length/c[d]),f=Math.ceil((s-a)/s*(h[d].length/c[d]));let g=0,x=0;for(let u=0;u<c[d]&&!(n>=r);++u){l=0==u?a:0,x=0==u?f:i;let c,b,p=h[d].substr(g,x),w=this.ctx.measureText(p).width;for(;g+x<=h[d].length&&(s-w-l>t.css.fontSize.toPx()||w-s>t.css.fontSize.toPx());){if(w<s)p=h[d].substr(g,++x);else{if(p.length<=1)break;p=h[d].substr(g,--x)}w=this.ctx.measureText(p).width}if(g+=p.length,n===r-1&&(d<h.length-1||g<h[d].length)){for(;this.ctx.measureText(`${p}...`).width>s&&!(p.length<=1);)p=p.substring(0,p.length-1);p+="...",w=this.ctx.measureText(p).width}switch(this.ctx.textAlign=t.css.textAlign?t.css.textAlign:"left",t.css.textAlign){case"center":c=0,b=c-w/2+l;break;case"right":c=s/2,b=c-w+l;break;default:c=-s/2+l,b=c}const P=-e/2+(0===n?t.css.fontSize.toPx():t.css.fontSize.toPx()+n*o);n++,"stroke"===t.css.textStyle?this.ctx.strokeText(p,c,P,w):this.ctx.fillText(p,c,P,w);const y=t.css.fontSize.toPx();t.css.textDecoration&&(this.ctx.lineWidth=y/13,this.ctx.beginPath(),/\bunderline\b/.test(t.css.textDecoration)&&(this.ctx.moveTo(b,P),this.ctx.lineTo(b+w,P)),/\boverline\b/.test(t.css.textDecoration)&&(this.ctx.moveTo(b,P-y),this.ctx.lineTo(b+w,P-y)),/\bline-through\b/.test(t.css.textDecoration)&&(this.ctx.moveTo(b,P-y/3),this.ctx.lineTo(b+w,P-y/3)),this.ctx.closePath(),this.ctx.strokeStyle=t.css.color,this.ctx.stroke())}}this.ctx.restore(),this._doBorder(t,s,e)}_drawAbsRect(t){this.ctx.save();const{width:s,height:e}=this._preProcess(t);C(t.css.color)?A(t.css.color,s,e,this.ctx):this.ctx.fillStyle=t.css.color;const{borderRadius:i,borderStyle:r,borderWidth:o}=t.css;this._border({borderRadius:i,width:s,height:e,borderWidth:o,borderStyle:r}),this.ctx.fill(),this.ctx.restore(),this._doBorder(t,s,e)}_doShadow(t){if(!t.css||!t.css.shadow)return;const s=t.css.shadow.replace(/,\s+/g,",").split(/\s+/);s.length>4?console.error("shadow don't spread option"):(this.ctx.shadowOffsetX=parseInt(s[0],10),this.ctx.shadowOffsetY=parseInt(s[1],10),this.ctx.shadowBlur=parseInt(s[2],10),this.ctx.shadowColor=s[3])}_getAngle(t){return Number(t)*Math.PI/180}}const z=(t,s)=>{if(t===s)return!0;if(t&&s&&"object"==typeof t&&"object"==typeof s){var e,i,r,o=Array.isArray(t),h=Array.isArray(s);if(o&&h){if((i=t.length)!=s.length)return!1;for(e=i;0!=e--;)if(!z(t[e],s[e]))return!1;return!0}if(o!=h)return!1;var c=t instanceof Date,a=s instanceof Date;if(c!=a)return!1;if(c&&a)return t.getTime()==s.getTime();var n=t instanceof RegExp,l=s instanceof RegExp;if(n!=l)return!1;if(n&&l)return t.toString()==s.toString();var d=Object.keys(t);if((i=d.length)!==Object.keys(s).length)return!1;for(e=i;0!=e--;)if(!Object.prototype.hasOwnProperty.call(s,d[e]))return!1;for(e=i;0!=e--;)if(r=d[e],!z(t[r],s[r]))return!1;return!0}return t!=t&&s!=s};const O=s.defineComponent({name:"VueCanvasPoster",props:{painting:{type:Object,default:function(){return{}}},dirty:{type:Boolean,default:!1},widthPixels:{type:Number,default:750}},data:()=>({paintCount:0,painterStyle:"",canvasWidthInPx:375,canvasHeightInPx:375,width:100,height:100,canvas:null,ctx:null}),watch:{painting:{handler(t,s){this.isNeedRefresh(t,s)&&(this.paintCount=0,this.$nextTick((()=>{this.startPaint()})))},deep:!0,immediate:!0}},methods:{isEmpty(t){for(const s in t)return!1;return!0},isNeedRefresh(t,s){return!(!t||this.isEmpty(t)||this.dirty&&z(t,s))},startPaint(){this.isEmpty(this.painting)||(j(1),this.downloadImages().then((t=>{const{width:s,height:e}=t;if(!s||!e)return void console.error(`You should set width and height correctly for painter, width: ${s}, height: ${e}`);this.canvasWidthInPx=s.toPx(),this.widthPixels&&(j(this.widthPixels/this.canvasWidthInPx),this.canvasWidthInPx=this.widthPixels),this.canvasHeightInPx=e.toPx(),this.painterStyle=`width:${this.canvasWidthInPx}px;height:${this.canvasHeightInPx}px;`,this.canvas=this.$refs.canvasRef,this.canvas.width=this.canvasWidthInPx,this.canvas.height=this.canvasHeightInPx;const i=this.canvas.getContext("2d");new $(i,t).paint((()=>{var t=this.canvas.toDataURL("image/png");this.$emit("success",t)}))})).catch((t=>{this.$emit("fail",t)})))},downloadImages(){return new Promise((t=>{let s=0,e=0;const i=JSON.parse(JSON.stringify(this.painting));if(i.background&&(s++,this.loadImage(i.background).then((r=>{i.background=r,e++,s===e&&t(i)}),(r=>{e++,s===e&&t(i),console.log(r)}))),i.views)for(const r of i.views)r&&"image"===r.type&&r.url&&(s++,this.loadImage(r.url).then((o=>{e++,r.url=o,r.sWidth=o.width,r.sHeight=o.height,s===e&&t(i)}),(r=>{e++,s===e&&t(i),console.log(r)})));0===s&&t(i)}))},loadImage:t=>new Promise(((s,e)=>{if(t.startsWith("#"))return void s(t);const i=new Image;i.onload=()=>s(i),i.onerror=()=>e(`下载图片失败 ${t}`),i.crossOrigin="anonymous",i.src=t,!0===i.complete&&setTimeout((()=>s(i)),500)}))},render(){return s.h("div",[s.h("canvas",{ref:"canvasRef",class:"canvas",style:this.painterStyle})])}});function j(t){String.prototype.toPx=function(s,e){if("0"===this)return 0;let i;i=s?/^-?[0-9]+([.]{1}[0-9]+){0,1}(px|%)$/g:/^[0-9]+([.]{1}[0-9]+){0,1}(px|%)$/g;const r=i.exec(this)[2],o=parseFloat(this);let h=0;return"px"===r?h=Math.round(o*(t||1)):"%"===r&&(h=Math.round(o*e/100)),h}}function B(t){t.component("VueCanvasPoster",O)}O.__scopeId="data-v-20401835";const D={install:B};let L=null;"undefined"!=typeof window?L=window.Vue:"undefined"!=typeof global&&(L=global.Vue),L&&L.use(D),t.VueCanvasPoster=O,t.default=D,t.install=B,Object.defineProperty(t,"__esModule",{value:!0}),t[Symbol.toStringTag]="Module"}));
